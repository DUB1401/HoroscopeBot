# HoroscopeBot
**HoroscopeBot** – это бот [Telegram](https://telegram.org/), генерирующий гороскопы на каждый день при помощи GPT-4 и позволяющий выполнять рассылку использующим его пользователям. Бот также поддерживает проверку подписки на указанные чаты при инициализации работы.

## Порядок установки и использования
1. Загрузить последний релиз. Распаковать.
2. Установить Python версии не старше 3.10.
3. В среду исполнения установить следующие пакеты: [pyTelegramBotAPI](https://github.com/eternnoir/pyTelegramBotAPI?ysclid=loq3f2bmuz181940716), [APScheduler](https://github.com/agronholm/apscheduler), [freeGPT](https://github.com/Ruu3f/freeGPT), [dublib](https://github.com/DUB1401/dublib), [g4f](https://github.com/xtekky/gpt4free).
```
pip install pyTelegramBotAPI
pip install APScheduler
pip install freeGPT
pip install dublib
pip install g4f
```
Либо установить сразу все пакеты при помощи следующей команды, выполненной из директории скрипта.
```
pip install -r requirements.txt
```
4. Настроить скрипт путём редактирования _Settings.json_.
5. Открыть директорию со скриптом в терминале. Можно использовать метод `cd` и прописать путь к папке, либо запустить терминал из проводника.
6. Указать для выполнения главный файл скрипта `main.py`, перейти в Telegram, отправить в чат с ботом команду `/start`. Для доступа к панели управления необходимо отправить боту установленный в настройках пароль и команду `/admin`.
7. Для автоматического запуска службы рекомендуется провести инициализацию скрипта через [systemd](https://github.com/systemd/systemd) (пример [здесь](https://github.com/DUB1401/HoroscopeBot/tree/main/systemd)) на Linux или путём добавления его в автозагрузку на Windows.

> [!NOTE]  
> Для внепланового обновления гороскопа можно выполнить скрипт с аргументом `main.py update`, после чего перезапустить бота.

# Команды
```
/admin
```
Открывает панель управления ботом.
___
```
/start
```
Инициализирует работу бота.
___
```
/unattach
```
Удаляет все вложения.

# Settings.json
```JSON
"token": ""
```
Сюда необходимо занести токен бота Telegram (можно получить у [BotFather](https://t.me/BotFather)).
___
```JSON
"lib": "g4f"
```
Указывает библиотеку, используемую для доступа к GPT-4. Поддерживаются: _freeGPT_, _g4f_.
___
```JSON
"timezone": "Europe/Moscow"
```
Указывает часовой пояс, по которому в полночь будет происходить обновление гороскопов.
___

```JSON
"premium": false
```
Здесь указывается, имеется ли у хозяина бота Premium-подписка. Влияет на максимальную длину сообщения.
___
```JSON
"password": "1234"
```
Пароль для авторизации администратора.
___
```JSON
"message": "Здравствуйте!"
```
Текст сообщения рассылки. Поддерживает HTML разметку, допустимую в Telegram.
___
```JSON
"collect-media": false
```
Состояние: идёт ли в данный момент приём вложений.
___
```JSON
"subscription-notification": "Для использования бота подпишитесь на наши чаты."
```
Текст уведомления о необходимости подписки. Поддерживает HTML разметку, допустимую в Telegram.
___
```JSON
"always-check-subscriptions": false
```
Указывает, необходимо ли проверять подписки на каналы и группы при каждом взаимодействии пользователя с ботом.
___
```JSON
"required-subscriptions": {
	"{CHAT_ID}": {
		"link": "",
		"title": ""
	}
}
```
Здесь можно определить перечень чатов, подписка на которые обязательна для инициации работы бота. Перед проверкой бот должен стать администратором целевого чата. ID группы или канала можно узнать при помощи [Chat ID Bot](https://t.me/chat_id_echo_bot). Данное правило игнорируется пользователями, определёнными как администраторы бота.
___
```JSON
"delay": 1
```
Интервал в секундах между последовательными запросами к серверам Telegram.

_Copyright © DUB1401. 2023-2024._
